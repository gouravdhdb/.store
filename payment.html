<!DOCTYPE html>
<html>
<head>
  <title>Pay Online - The Decken</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    .qr-box {
      border: 1px solid #ccc;
      padding: 15px;
      margin-top: 20px;
      display: inline-block;
    }
    .payment-buttons a {
      display: inline-block;
      margin: 10px;
      padding: 10px 20px;
      background-color: #007bff;
      color: white;
      border-radius: 6px;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <h2>Complete Your Payment</h2>

  <div id="product-list"></div>
  <h3>Total: â‚¹<span id="total-amount">0</span></h3>

  <div class="qr-box">
    <p>Scan QR Code to Pay</p>
    <img src="qr-code.jpg" width="200" alt="QR Code"> <!-- Replace with your actual QR code image -->
  </div>

  <div class="payment-buttons">
    <a id="upi-link" href="#" target="_blank">Pay with UPI App</a>
  </div>
  
  <div style="margin-top: 30px;">
  <button onclick="confirmPayment()" style="padding: 15px 30px; font-size: 1.1rem; background-color: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer;">Confirm Payment & Place Order</button>
  </div>

  <script>
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const productList = document.getElementById('product-list');
    const totalAmount = document.getElementById('total-amount');

    let total = 0;

    cart.forEach(item => {
      const div = document.createElement('div');
      div.innerText = `${item.name} - â‚¹${item.price} x ${item.quantity}`;
      productList.appendChild(div);
      total += item.price * item.quantity;
    });

    totalAmount.innerText = total;

    const upiId = "9988720946@ybl"; // â† Replace with your real UPI ID
    const upiLink = document.getElementById("upi-link");
    upiLink.href = `upi://pay?pa=${upiId}&pn=TheDecken&am=${total}&cu=INR`;
    
    function confirmPayment() {
  const pendingOrder = JSON.parse(localStorage.getItem('pendingOrder'));
  if (!pendingOrder) {
    alert("No pending order found.");
    return;
  }

  // Load existing orders
  const existingOrders = JSON.parse(localStorage.getItem('orders')) || [];
  existingOrders.unshift(pendingOrder);
  localStorage.setItem('orders', JSON.stringify(existingOrders));

  // Send to Telegram (optional)
  fetch(`https://api.telegram.org/bot7942211815:AAGo9GylL7zO_SUWWkqJn1AFH40DO-Q0cqY/sendMessage`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      chat_id: '-4891793325',
      text: `ðŸ›’ New Online Payment Order from ${pendingOrder.customer.name}
ðŸ“ Address: ${pendingOrder.customer.address}
ðŸ“ž Phone: ${pendingOrder.customer.phone}
ðŸ’³ Payment: ${pendingOrder.paymentMethod}
ðŸ“¦ Items: ${pendingOrder.items.map(i => `${i.name} (x${i.quantity}) - â‚¹${i.price * i.quantity}`).join(', ')}
ðŸ’° Total: â‚¹${pendingOrder.total}
ðŸ§¾ Discount: â‚¹${pendingOrder.discountApplied}`
    })
  });

  // Clean up
  localStorage.removeItem('pendingOrder');
  localStorage.removeItem('cart');

  alert("Payment confirmed and order placed successfully!");
  window.location.href = "index.html";
    }
  </script>
</body>
</html>
